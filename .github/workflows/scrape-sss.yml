name: Scraper SSS Formations
# Dernière mise à jour: 2026-01-25 - TEST schedule automatique (toutes les 5 min)
# IMPORTANT: Remettre '17 5 * * *' après le test!

on:
  # Schedule: 5h17 UTC = 6h17 France (backup si cron-job.org échoue)
  schedule:
    - cron: '17 5 * * *'

  # Trigger externe via cron-job.org (FIABLE)
  repository_dispatch:
    types: [trigger-scraper]

  # Permettre l'exécution manuelle
  workflow_dispatch:

jobs:
  scrape:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install Playwright
        run: |
          pip install playwright supabase
          playwright install chromium

      - name: Run scraper
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_SERVICE_KEY: ${{ secrets.SUPABASE_SERVICE_KEY }}
        run: |
          python .github/scripts/scrape_sss.py

      - name: Notify on failure
        if: failure()
        run: |
          echo "❌ Scraping failed - check logs"
